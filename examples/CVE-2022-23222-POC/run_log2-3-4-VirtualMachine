root@syzkaller:~/DRACO-verifier/examples/CVE-2022-23222-POC# make symbex-cve-2022-2322
# compile the program
clang-13 \
        -DKLEE_VERIFICATION\
        -DVERIFY_INTERACTIONS\
        -DKLEE_SYM_PRINTF \
        -I/root/DRACO-verifier/examples/CVE-2022-23222-POC/../headers/ -I /usr/include/unknown-linux-gnu -I/root/DRACO-verifier/examples/../ebpf-se/libbpf-stubbed/src/build/usr/include/  \
                -DKLEE_SYM_PRINTF \
                $(KLEE_BPF_CFLAGS) \
root@syzkaller:~/DRACO-verifier/examples/CVE-2022-23222-POC# make symbex-cve-2022-2322
# compile the program
clang-13 \
        -DKLEE_VERIFICATION\
        -DVERIFY_INTERACTIONS\
        -DKLEE_SYM_PRINTF \
        -I/root/DRACO-verifier/examples/CVE-2022-23222-POC/../headers/ -I /usr/include/unknown-linux-gnu -I/root/DRACO-verifier/examples/../ebpf-se/libbpf-stubbed/src/build/usr/include/  \
        -I  \
        -D__USE_VMLINUX__ \
        -D__TARGET_ARCH_x86 \
        -DBPF_NO_PRESERVE_ACCESS_INDEX \
        -Wall \
        -Wno-unused-value \
        -Wno-unused-variable \
        -Wno-pointer-sign \
        -Wno-compare-distinct-pointer-types \
        -Werror \
        -fno-discard-value-names \
        -fno-builtin \
        -O0 -emit-llvm -c -g exploit.c
llvm-dis-13 -show-annotations exploit.bc
/root/DRACO-verifier/klee/build/bin/klee -kdalloc -kdalloc-heap-start-address=0x00040000000 -kdalloc-heap-size=1 -libc=uclibc --external-calls=all --disable-verify \
        -solver-backend=z3 --exit-on-error -max-memory=750000 -search=dfs -single-object-resolution=true -link-llvm-lib=/root/DRACO-verifier/ebpf-se/libbpf-stubbed/src/obj/libbpf.bc \
        -verification=true exploit.bc
KLEE: NOTE: Using klee-uclibc : /root/DRACO-verifier/klee/build/runtime/lib/klee-uclibc.bca
KLEE: output directory is "/root/DRACO-verifier/examples/CVE-2022-23222-POC/klee-out-0"
KLEE: Using Z3 solver backend
KLEE: Deterministic allocator: Using quarantine queue size 8
KLEE: Deterministic allocator: globals (start-address=0x7fd4f75c8000 size=10 GiB)
KLEE: Deterministic allocator: constants (start-address=0x7fd2775c8000 size=10 GiB)
KLEE: Deterministic allocator: heap (start-address=0x40000000 size=1 GiB)
KLEE: Deterministic allocator: stack (start-address=0x7fb2775c8000 size=128 GiB)
KLEE: WARNING ONCE: unsupported intrinsic llvm.vector.reduce.add.v4i32
WARNING: this target does not support the llvm.stacksave intrinsic.
KLEE: WARNING: undefined reference to function: __ctype_b_loc
KLEE: WARNING: undefined reference to function: __isoc99_fscanf
KLEE: WARNING: undefined reference to function: __isoc99_sscanf
KLEE: WARNING: undefined reference to function: __syscall_rt_sigaction
KLEE: WARNING: undefined reference to function: _stdio_init
KLEE: WARNING: undefined reference to function: bcmp
KLEE: WARNING: undefined reference to function: clock_gettime
KLEE: WARNING: undefined reference to function: close
KLEE: WARNING: undefined reference to function: dup3
KLEE: WARNING: undefined reference to function: elf64_getehdr
KLEE: WARNING: undefined reference to function: elf64_getshdr
KLEE: WARNING: undefined reference to function: elf64_newehdr
KLEE: WARNING: undefined reference to function: elf_begin
KLEE: WARNING: undefined reference to function: elf_end
KLEE: WARNING: undefined reference to function: elf_errmsg
KLEE: WARNING: undefined reference to function: elf_getdata
KLEE: WARNING: undefined reference to function: elf_getphdrnum
KLEE: WARNING: undefined reference to function: elf_getscn
KLEE: WARNING: undefined reference to function: elf_getshdrnum
KLEE: WARNING: undefined reference to function: elf_getshdrstrndx
KLEE: WARNING: undefined reference to function: elf_kind
KLEE: WARNING: undefined reference to function: elf_memory
KLEE: WARNING: undefined reference to function: elf_ndxscn
KLEE: WARNING: undefined reference to function: elf_newdata
KLEE: WARNING: undefined reference to function: elf_newscn
KLEE: WARNING: undefined reference to function: elf_nextscn
KLEE: WARNING: undefined reference to function: elf_rawdata
KLEE: WARNING: undefined reference to function: elf_strptr
KLEE: WARNING: undefined reference to function: elf_update
KLEE: WARNING: undefined reference to function: elf_version
KLEE: WARNING: undefined reference to function: epoll_create1
KLEE: WARNING: undefined reference to function: epoll_ctl
KLEE: WARNING: undefined reference to function: epoll_wait
KLEE: WARNING: undefined reference to function: execve
KLEE: WARNING: undefined reference to function: faccessat
KLEE: WARNING: undefined reference to function: fcntl
KLEE: WARNING: undefined reference to function: fcntl64
KLEE: WARNING: undefined reference to function: fmemopen
KLEE: WARNING: undefined reference to function: fopen64
KLEE: WARNING: undefined reference to function: fseeko64
KLEE: WARNING: undefined reference to function: fstat
KLEE: WARNING: undefined reference to function: ftello64
KLEE: WARNING: undefined reference to function: gelf_getclass
KLEE: WARNING: undefined reference to function: gelf_getehdr
KLEE: WARNING: undefined reference to function: gelf_getnote
KLEE: WARNING: undefined reference to function: gelf_getphdr
KLEE: WARNING: undefined reference to function: gelf_getshdr
KLEE: WARNING: undefined reference to function: gelf_getsym
KLEE: WARNING: undefined reference to function: gzclose
KLEE: WARNING: undefined reference to function: gzgets
KLEE: WARNING: undefined reference to function: gzopen64
KLEE: WARNING: undefined reference to function: ioctl
KLEE: WARNING: undefined reference to function: lseek64
KLEE: WARNING: undefined reference to function: mkdir
KLEE: WARNING: undefined reference to function: mmap64
KLEE: WARNING: undefined reference to function: munmap
KLEE: WARNING: undefined reference to function: nanosleep
KLEE: WARNING: undefined reference to function: open
KLEE: WARNING: undefined reference to function: open64
KLEE: WARNING: undefined reference to function: read
KLEE: WARNING: undefined reference to function: readlink
KLEE: WARNING: undefined reference to function: setrlimit64
KLEE: WARNING: undefined reference to function: sigprocmask
KLEE: WARNING: undefined reference to function: snprintf
KLEE: WARNING: undefined reference to function: sprintf
KLEE: WARNING: undefined reference to function: statfs64
KLEE: WARNING: undefined reference to function: syscall
KLEE: WARNING: undefined reference to function: time
KLEE: WARNING: undefined reference to function: unlink
KLEE: WARNING: undefined reference to function: vfork
KLEE: WARNING: undefined reference to function: vsnprintf
KLEE: WARNING: undefined reference to function: wait4
KLEE: WARNING: undefined reference to function: write
KLEE: WARNING: undefined reference to function: kill (UNSAFE)!
KLEE: WARNING ONCE: calling __user_main with extra arguments.
KLEE: WARNING ONCE: calling external: syscall(321, 0, 140458170548224, 120) at exploit.c:55 12
KLEE: WARNING ONCE: calling external: printf(140546485813248, 12) at exploit.c:253 8
Return from syscall : 12
[+] eBPF enabled, ringbuf created!
root@syzkaller:~/DRACO-verifier/examples/CVE-2022-23222-POC# make symbex-cve-2022-2322 2>&1 logs.txt
# compile the program
clang-13 \
        -DKLEE_VERIFICATION\
        -DVERIFY_INTERACTIONS\
        -DKLEE_SYM_PRINTF \
        -I/root/DRACO-verifier/examples/CVE-2022-23222-POC/../headers/ -I /usr/include/unknown-linux-gnu -I/root/DRACO-verifier/examples/../ebpf-se/libbpf-stubbed/src/build/usr/include/  \
        -I  \
        -D__USE_VMLINUX__ \
        -D__TARGET_ARCH_x86 \
        -DBPF_NO_PRESERVE_ACCESS_INDEX \
        -Wall \
        -Wno-unused-value \
        -Wno-unused-variable \
        -Wno-pointer-sign \
        -Wno-compare-distinct-pointer-types \
        -Werror \
        -fno-discard-value-names \
        -fno-builtin \
        -O0 -emit-llvm -c -g exploit.c
llvm-dis-13 -show-annotations exploit.bc
/root/DRACO-verifier/klee/build/bin/klee -kdalloc -kdalloc-heap-start-address=0x00040000000 -kdalloc-heap-size=1 -libc=uclibc --external-calls=all --disable-verify \
        -solver-backend=z3 --exit-on-error -max-memory=750000 -search=dfs -single-object-resolution=true -link-llvm-lib=/root/DRACO-verifier/ebpf-se/libbpf-stubbed/src/obj/libbpf.bc \
        -verification=true exploit.bc
KLEE: NOTE: Using klee-uclibc : /root/DRACO-verifier/klee/build/runtime/lib/klee-uclibc.bca
KLEE: output directory is "/root/DRACO-verifier/examples/CVE-2022-23222-POC/klee-out-1"
KLEE: Using Z3 solver backend
KLEE: Deterministic allocator: Using quarantine queue size 8
KLEE: Deterministic allocator: globals (start-address=0x7fab55d86000 size=10 GiB)
KLEE: Deterministic allocator: constants (start-address=0x7fa8d5d86000 size=10 GiB)
KLEE: Deterministic allocator: heap (start-address=0x40000000 size=1 GiB)
KLEE: Deterministic allocator: stack (start-address=0x7f88d5d86000 size=128 GiB)
KLEE: WARNING ONCE: unsupported intrinsic llvm.vector.reduce.add.v4i32
WARNING: this target does not support the llvm.stacksave intrinsic.
KLEE: WARNING: undefined reference to function: __ctype_b_loc
KLEE: WARNING: undefined reference to function: __isoc99_fscanf
KLEE: WARNING: undefined reference to function: __isoc99_sscanf
KLEE: WARNING: undefined reference to function: __syscall_rt_sigaction
KLEE: WARNING: undefined reference to function: _stdio_init
KLEE: WARNING: undefined reference to function: bcmp
KLEE: WARNING: undefined reference to function: clock_gettime
KLEE: WARNING: undefined reference to function: close
KLEE: WARNING: undefined reference to function: dup3
KLEE: WARNING: undefined reference to function: elf64_getehdr
KLEE: WARNING: undefined reference to function: elf64_getshdr
KLEE: WARNING: undefined reference to function: elf64_newehdr
KLEE: WARNING: undefined reference to function: elf_begin
KLEE: WARNING: undefined reference to function: elf_end
KLEE: WARNING: undefined reference to function: elf_errmsg
KLEE: WARNING: undefined reference to function: elf_getdata
KLEE: WARNING: undefined reference to function: elf_getphdrnum
KLEE: WARNING: undefined reference to function: elf_getscn
KLEE: WARNING: undefined reference to function: elf_getshdrnum
KLEE: WARNING: undefined reference to function: elf_getshdrstrndx
KLEE: WARNING: undefined reference to function: elf_kind
KLEE: WARNING: undefined reference to function: elf_memory
KLEE: WARNING: undefined reference to function: elf_ndxscn
KLEE: WARNING: undefined reference to function: elf_newdata
KLEE: WARNING: undefined reference to function: elf_newscn
KLEE: WARNING: undefined reference to function: elf_nextscn
KLEE: WARNING: undefined reference to function: elf_rawdata
KLEE: WARNING: undefined reference to function: elf_strptr
KLEE: WARNING: undefined reference to function: elf_update
KLEE: WARNING: undefined reference to function: elf_version
KLEE: WARNING: undefined reference to function: epoll_create1
KLEE: WARNING: undefined reference to function: epoll_ctl
KLEE: WARNING: undefined reference to function: epoll_wait
KLEE: WARNING: undefined reference to function: execve
KLEE: WARNING: undefined reference to function: faccessat
KLEE: WARNING: undefined reference to function: fcntl
KLEE: WARNING: undefined reference to function: fcntl64
KLEE: WARNING: undefined reference to function: fmemopen
KLEE: WARNING: undefined reference to function: fopen64
KLEE: WARNING: undefined reference to function: fseeko64
KLEE: WARNING: undefined reference to function: fstat
KLEE: WARNING: undefined reference to function: ftello64
KLEE: WARNING: undefined reference to function: gelf_getclass
KLEE: WARNING: undefined reference to function: gelf_getehdr
KLEE: WARNING: undefined reference to function: gelf_getnote
KLEE: WARNING: undefined reference to function: gelf_getphdr
KLEE: WARNING: undefined reference to function: gelf_getshdr
KLEE: WARNING: undefined reference to function: gelf_getsym
KLEE: WARNING: undefined reference to function: gzclose
KLEE: WARNING: undefined reference to function: gzgets
KLEE: WARNING: undefined reference to function: gzopen64
KLEE: WARNING: undefined reference to function: ioctl
KLEE: WARNING: undefined reference to function: lseek64
KLEE: WARNING: undefined reference to function: mkdir
KLEE: WARNING: undefined reference to function: mmap64
KLEE: WARNING: undefined reference to function: munmap
KLEE: WARNING: undefined reference to function: nanosleep
KLEE: WARNING: undefined reference to function: open
KLEE: WARNING: undefined reference to function: open64
KLEE: WARNING: undefined reference to function: read
KLEE: WARNING: undefined reference to function: readlink
KLEE: WARNING: undefined reference to function: setrlimit64
KLEE: WARNING: undefined reference to function: sigprocmask
KLEE: WARNING: undefined reference to function: snprintf
KLEE: WARNING: undefined reference to function: sprintf
KLEE: WARNING: undefined reference to function: statfs64
KLEE: WARNING: undefined reference to function: syscall
KLEE: WARNING: undefined reference to function: time
KLEE: WARNING: undefined reference to function: unlink
KLEE: WARNING: undefined reference to function: vfork
KLEE: WARNING: undefined reference to function: vsnprintf
KLEE: WARNING: undefined reference to function: wait4
KLEE: WARNING: undefined reference to function: write
KLEE: WARNING: undefined reference to function: kill (UNSAFE)!
KLEE: WARNING ONCE: calling __user_main with extra arguments.
KLEE: WARNING ONCE: calling external: syscall(321, 0, 140279367098368, 120) at exploit.c:55 12
KLEE: WARNING ONCE: calling external: printf(140367682363392, 12) at exploit.c:253 8
Return from syscall : 12
[+] eBPF enabled, ringbuf created!
[!] staring to create new maps until we get two consecutive maps
[+] created map 1
KLEE: WARNING ONCE: calling external: open(140367145492480, 0) at exploit.c:164 9
KLEE: WARNING ONCE: calling external: read(14, 140250912940032, 8) at exploit.c:172 17
[+] generated random value: 26a679c7dad3583
[+] created map 2
[+] generated random value: 6c66c2038f66194
[+] two new maps created!
KLEE: WARNING ONCE: Alignment of memory from call "calloc" is not modelled. Using alignment of 8.
KLEE: WARNING ONCE: calling external: getpagesize() at ringbuf.c:196 18
KLEE: WARNING ONCE: calling external: epoll_create1(524288) at ringbuf.c:198 6
KLEE: WARNING ONCE: Alignment of memory from call "realloc" is not modelled. Using alignment of 8.
KLEE: WARNING ONCE: calling external: mmap64(0, 4096, 3, 1, 12, 0) at ringbuf.c:0 0
KLEE: WARNING ONCE: calling external: epoll_ctl(17, 1, 12, 1308622848) at ringbuf.c:153 56
KLEE: WARNING ONCE: calling external: write(1, 140229974974464, 1) at libc/stdio/_WRITE.c:52 11

KLEE: WARNING ONCE: calling external: close(0) at exploit.c:151 11
[-] failed to run eBPF program!
[+] value read from slab: 0

[-] failed to run eBPF program!
[+] value read from slab: 0
[+] created map 3
[+] generated random value: 8b4fefefecbbd6f1
[+] created map 4
[+] generated random value: 5da676d52a091e0c
[+] eBPF enabled, maps created!

[-] failed to run eBPF program!
[+] value read from slab: 0

[-] failed to run eBPF program!
[+] value read from slab: 0
[+] created map 5
[+] generated random value: 5d1928433865477f
[+] created map 6
[+] generated random value: 916f47c4f3032c47
[+] eBPF enabled, maps created!

[-] failed to run eBPF program!
[+] value read from slab: 0

[-] failed to run eBPF program!
[+] value read from slab: 0
[+] created map 7
[+] generated random value: 33c7198a6d2a33e1
[+] created map 8
[+] generated random value: 6590be0d4b68f925
[+] eBPF enabled, maps created!

[-] failed to run eBPF program!
[+] value read from slab: 0

[-] failed to run eBPF program!
[+] value read from slab: 0
[+] created map 9
[+] generated random value: f36e5efe46008efd
[+] created map 10
[+] generated random value: dd43cd40b5c859df
[+] eBPF enabled, maps created!

[-] failed to run eBPF program!
[+] value read from slab: 0

[-] failed to run eBPF program!
[+] value read from slab: 0
[+] created map 11
[+] generated random value: 956b2407911dc9a1
[+] created map 12
[+] generated random value: d220a198f58ab811
[+] eBPF enabled, maps created!

[-] failed to run eBPF program!
[+] value read from slab: 0

root@syzkaller:~/DRACO-verifier/examples/CVE-2022-23222-POC# ls
Makefile   bpf.c  buildnew.sh  exploit.c  exploit.ll  klee-out-0
README.md  bpf.h  exploit.bc   exploit.h  klee-last   klee-out-1
root@syzkaller:~/DRACO-verifier/examples/CVE-2022-23222-POC# make symbex-cve-2022-2322
# compile the program
clang-13 \
        -DKLEE_VERIFICATION\
        -DVERIFY_INTERACTIONS\
        -DKLEE_SYM_PRINTF \
        -I/root/DRACO-verifier/examples/CVE-2022-23222-POC/../headers/ -I /usr/include/unknown-linux-gnu -I/root/DRACO-verifier/examples/../ebpf-se/libbpf-stubbed/src/build/usr/include/  \
        -I  \
        -D__USE_VMLINUX__ \
        -D__TARGET_ARCH_x86 \
        -DBPF_NO_PRESERVE_ACCESS_INDEX \
        -Wall \
        -Wno-unused-value \
        -Wno-unused-variable \
        -Wno-pointer-sign \
        -Wno-compare-distinct-pointer-types \
        -Werror \
        -fno-discard-value-names \
        -fno-builtin \
        -O0 -emit-llvm -c -g exploit.c
llvm-dis-13 -show-annotations exploit.bc
/root/DRACO-verifier/klee/build/bin/klee -kdalloc -kdalloc-heap-start-address=0x00040000000 -kdalloc-heap-size=1 -libc=uclibc --external-calls=all --disable-verify \
        -solver-backend=z3 --exit-on-error -max-memory=750000 -search=dfs -single-object-resolution=true -link-llvm-lib=/root/DRACO-verifier/ebpf-se/libbpf-stubbed/src/obj/libbpf.bc \
        -verification=true exploit.bc
KLEE: NOTE: Using klee-uclibc : /root/DRACO-verifier/klee/build/runtime/lib/klee-uclibc.bca
KLEE: output directory is "/root/DRACO-verifier/examples/CVE-2022-23222-POC/klee-out-2"
KLEE: Using Z3 solver backend
KLEE: Deterministic allocator: Using quarantine queue size 8
KLEE: Deterministic allocator: globals (start-address=0x7f511f203000 size=10 GiB)
KLEE: Deterministic allocator: constants (start-address=0x7f4e9f203000 size=10 GiB)
KLEE: Deterministic allocator: heap (start-address=0x40000000 size=1 GiB)
KLEE: Deterministic allocator: stack (start-address=0x7f2e9f203000 size=128 GiB)
KLEE: WARNING ONCE: unsupported intrinsic llvm.vector.reduce.add.v4i32
WARNING: this target does not support the llvm.stacksave intrinsic.
KLEE: WARNING: undefined reference to function: __ctype_b_loc
KLEE: WARNING: undefined reference to function: __isoc99_fscanf
KLEE: WARNING: undefined reference to function: __isoc99_sscanf
KLEE: WARNING: undefined reference to function: __syscall_rt_sigaction
KLEE: WARNING: undefined reference to function: _stdio_init
KLEE: WARNING: undefined reference to function: bcmp
KLEE: WARNING: undefined reference to function: clock_gettime
KLEE: WARNING: undefined reference to function: close
KLEE: WARNING: undefined reference to function: dup3
KLEE: WARNING: undefined reference to function: elf64_getehdr
KLEE: WARNING: undefined reference to function: elf64_getshdr
KLEE: WARNING: undefined reference to function: elf64_newehdr
KLEE: WARNING: undefined reference to function: elf_begin
KLEE: WARNING: undefined reference to function: elf_end
KLEE: WARNING: undefined reference to function: elf_errmsg
KLEE: WARNING: undefined reference to function: elf_getdata
KLEE: WARNING: undefined reference to function: elf_getphdrnum
KLEE: WARNING: undefined reference to function: elf_getscn
KLEE: WARNING: undefined reference to function: elf_getshdrnum
KLEE: WARNING: undefined reference to function: elf_getshdrstrndx
KLEE: WARNING: undefined reference to function: elf_kind
KLEE: WARNING: undefined reference to function: elf_memory
KLEE: WARNING: undefined reference to function: elf_ndxscn
KLEE: WARNING: undefined reference to function: elf_newdata
KLEE: WARNING: undefined reference to function: elf_newscn
KLEE: WARNING: undefined reference to function: elf_nextscn
KLEE: WARNING: undefined reference to function: elf_rawdata
KLEE: WARNING: undefined reference to function: elf_strptr
KLEE: WARNING: undefined reference to function: elf_update
KLEE: WARNING: undefined reference to function: elf_version
KLEE: WARNING: undefined reference to function: epoll_create1
KLEE: WARNING: undefined reference to function: epoll_ctl
KLEE: WARNING: undefined reference to function: epoll_wait
KLEE: WARNING: undefined reference to function: execve
KLEE: WARNING: undefined reference to function: faccessat
KLEE: WARNING: undefined reference to function: fcntl
KLEE: WARNING: undefined reference to function: fcntl64
KLEE: WARNING: undefined reference to function: fmemopen
KLEE: WARNING: undefined reference to function: fopen64
KLEE: WARNING: undefined reference to function: fseeko64
KLEE: WARNING: undefined reference to function: fstat
KLEE: WARNING: undefined reference to function: ftello64
KLEE: WARNING: undefined reference to function: gelf_getclass
KLEE: WARNING: undefined reference to function: gelf_getehdr
KLEE: WARNING: undefined reference to function: gelf_getnote
KLEE: WARNING: undefined reference to function: gelf_getphdr
KLEE: WARNING: undefined reference to function: gelf_getshdr
KLEE: WARNING: undefined reference to function: gelf_getsym
KLEE: WARNING: undefined reference to function: gzclose
KLEE: WARNING: undefined reference to function: gzgets
KLEE: WARNING: undefined reference to function: gzopen64
KLEE: WARNING: undefined reference to function: ioctl
KLEE: WARNING: undefined reference to function: lseek64
KLEE: WARNING: undefined reference to function: mkdir
KLEE: WARNING: undefined reference to function: mmap64
KLEE: WARNING: undefined reference to function: munmap
KLEE: WARNING: undefined reference to function: nanosleep
KLEE: WARNING: undefined reference to function: open
KLEE: WARNING: undefined reference to function: open64
KLEE: WARNING: undefined reference to function: read
KLEE: WARNING: undefined reference to function: readlink
KLEE: WARNING: undefined reference to function: setrlimit64
KLEE: WARNING: undefined reference to function: sigprocmask
KLEE: WARNING: undefined reference to function: snprintf
KLEE: WARNING: undefined reference to function: sprintf
KLEE: WARNING: undefined reference to function: statfs64
KLEE: WARNING: undefined reference to function: syscall
KLEE: WARNING: undefined reference to function: time
KLEE: WARNING: undefined reference to function: unlink
KLEE: WARNING: undefined reference to function: vfork
KLEE: WARNING: undefined reference to function: vsnprintf
KLEE: WARNING: undefined reference to function: wait4
KLEE: WARNING: undefined reference to function: write
KLEE: WARNING: undefined reference to function: kill (UNSAFE)!
KLEE: WARNING ONCE: calling __user_main with extra arguments.
KLEE: WARNING ONCE: calling external: syscall(321, 0, 139891902001152, 120) at exploit.c:55 12
KLEE: WARNING ONCE: calling external: printf(139980217266176, 12) at exploit.c:253 8
Return from syscall : 12
[+] eBPF enabled, ringbuf created!
[!] staring to create new maps until we get two consecutive maps
[+] created map 1
KLEE: WARNING ONCE: calling external: open(139979680395264, 0) at exploit.c:164 9
KLEE: WARNING ONCE: calling external: read(14, 139863447842816, 8) at exploit.c:172 17
[+] generated random value: 845f9bb525e4504d
[+] created map 2
[+] generated random value: 79e021c3d980e9a7
[+] two new maps created!
KLEE: WARNING ONCE: Alignment of memory from call "calloc" is not modelled. Using alignment of 8.
KLEE: WARNING ONCE: calling external: getpagesize() at ringbuf.c:196 18
KLEE: WARNING ONCE: calling external: epoll_create1(524288) at ringbuf.c:198 6
KLEE: WARNING ONCE: Alignment of memory from call "realloc" is not modelled. Using alignment of 8.
KLEE: WARNING ONCE: calling external: mmap64(0, 4096, 3, 1, 12, 0) at ringbuf.c:0 0
KLEE: WARNING ONCE: calling external: epoll_ctl(17, 1, 12, 1308622848) at ringbuf.c:153 56
KLEE: WARNING ONCE: calling external: write(1, 139842509877248, 1) at libc/stdio/_WRITE.c:52 11

KLEE: WARNING ONCE: calling external: close(0) at exploit.c:151 11
[-] failed to run eBPF program!
[+] value read from slab: 0

[-] failed to run eBPF program!
[+] value read from slab: 0
[+] created map 3
[+] generated random value: f0d85f0c5b4a594e
[+] created map 4
[+] generated random value: 132d1df64eb4585e
[+] eBPF enabled, maps created!

[-] failed to run eBPF program!
[+] value read from slab: 0

[-] failed to run eBPF program!
[+] value read from slab: 0
[+] created map 5
[+] generated random value: 467ca8841770969f
[+] created map 6
[+] generated random value: 6db532fd0a01b5f9
[+] eBPF enabled, maps created!

[-] failed to run eBPF program!
[+] value read from slab: 0

[-] failed to run eBPF program!
[+] value read from slab: 0
[+] created map 7
[+] generated random value: 9edb0d8d467d62a8
[+] created map 8
[+] generated random value: c3b9cf5b15e5eee5
[+] eBPF enabled, maps created!

[-] failed to run eBPF program!
[+] value read from slab: 0

[-] failed to run eBPF program!
[+] value read from slab: 0
[+] created map 9
[+] generated random value: 8051c3f1f504565f
[+] created map 10
[+] generated random value: c5e2c72d7827f3ff
[+] eBPF enabled, maps created!

[-] failed to run eBPF program!
[+] value read from slab: 0

[-] failed to run eBPF program!
[+] value read from slab: 0
[+] created map 11
[+] generated random value: 2c5ab551d27bfc61
    };

root@syzkaller:~/DRACO-verifier/examples/CVE-2022-23222-POC# make symbex-cve-2022-2322

# compile the program
clang-13 \
        -DKLEE_VERIFICATION\
        -DVERIFY_INTERACTIONS\
        -DKLEE_SYM_PRINTF \
        -I/root/DRACO-verifier/examples/CVE-2022-23222-POC/../headers/ -I /usr/include/unknown-linux-gnu -I/root/DRACO-verifier/examples/../ebpf-se/libbpf-stubbed/src/build/usr/include/  \
        -I  \
        -D__USE_VMLINUX__ \
        -D__TARGET_ARCH_x86 \
        -DBPF_NO_PRESERVE_ACCESS_INDEX \
        -Wall \
        -Wno-unused-value \
        -Wno-unused-variable \
        -Wno-pointer-sign \
        -Wno-compare-distinct-pointer-types \
        -Werror \
        -fno-discard-value-names \
        -fno-builtin \
        -O0 -emit-llvm -c -g exploit.c
llvm-dis-13 -show-annotations exploit.bc
/root/DRACO-verifier/klee/build/bin/klee -kdalloc -kdalloc-heap-start-address=0x00040000000 -kdalloc-heap-size=1 -libc=uclibc --external-calls=all --disable-verify \
        -solver-backend=z3 --exit-on-error -max-memory=750000 -search=dfs -single-object-resolution=true -link-llvm-lib=/root/DRACO-verifier/ebpf-se/libbpf-stubbed/src/obj/libbpf.bc \
        -verification=true exploit.bc
KLEE: NOTE: Using klee-uclibc : /root/DRACO-verifier/klee/build/runtime/lib/klee-uclibc.bca
KLEE: output directory is "/root/DRACO-verifier/examples/CVE-2022-23222-POC/klee-out-3"
KLEE: Using Z3 solver backend
KLEE: Deterministic allocator: Using quarantine queue size 8
KLEE: Deterministic allocator: globals (start-address=0x7f8c364f1000 size=10 GiB)
KLEE: Deterministic allocator: constants (start-address=0x7f89b64f1000 size=10 GiB)
KLEE: Deterministic allocator: heap (start-address=0x40000000 size=1 GiB)
KLEE: Deterministic allocator: stack (start-address=0x7f69b64f1000 size=128 GiB)
KLEE: WARNING ONCE: unsupported intrinsic llvm.vector.reduce.add.v4i32
WARNING: this target does not support the llvm.stacksave intrinsic.
KLEE: WARNING: undefined reference to function: __ctype_b_loc
KLEE: WARNING: undefined reference to function: __isoc99_fscanf
KLEE: WARNING: undefined reference to function: __isoc99_sscanf
KLEE: WARNING: undefined reference to function: __syscall_rt_sigaction
KLEE: WARNING: undefined reference to function: _stdio_init
KLEE: WARNING: undefined reference to function: bcmp
KLEE: WARNING: undefined reference to function: clock_gettime
KLEE: WARNING: undefined reference to function: close
KLEE: WARNING: undefined reference to function: dup3
KLEE: WARNING: undefined reference to function: elf64_getehdr
KLEE: WARNING: undefined reference to function: elf64_getshdr
KLEE: WARNING: undefined reference to function: elf64_newehdr
KLEE: WARNING: undefined reference to function: elf_begin
KLEE: WARNING: undefined reference to function: elf_end
KLEE: WARNING: undefined reference to function: elf_errmsg
KLEE: WARNING: undefined reference to function: elf_getdata
KLEE: WARNING: undefined reference to function: elf_getphdrnum
KLEE: WARNING: undefined reference to function: elf_getscn
KLEE: WARNING: undefined reference to function: elf_getshdrnum
KLEE: WARNING: undefined reference to function: elf_getshdrstrndx
KLEE: WARNING: undefined reference to function: elf_kind
KLEE: WARNING: undefined reference to function: elf_memory
KLEE: WARNING: undefined reference to function: elf_ndxscn
KLEE: WARNING: undefined reference to function: elf_newdata
KLEE: WARNING: undefined reference to function: elf_newscn
KLEE: WARNING: undefined reference to function: elf_nextscn
KLEE: WARNING: undefined reference to function: elf_rawdata
KLEE: WARNING: undefined reference to function: elf_strptr
KLEE: WARNING: undefined reference to function: elf_update
KLEE: WARNING: undefined reference to function: elf_version
KLEE: WARNING: undefined reference to function: epoll_create1
KLEE: WARNING: undefined reference to function: epoll_ctl
KLEE: WARNING: undefined reference to function: epoll_wait
KLEE: WARNING: undefined reference to function: execve
KLEE: WARNING: undefined reference to function: faccessat
KLEE: WARNING: undefined reference to function: fcntl
KLEE: WARNING: undefined reference to function: fcntl64
KLEE: WARNING: undefined reference to function: fmemopen
KLEE: WARNING: undefined reference to function: fopen64
KLEE: WARNING: undefined reference to function: fseeko64
KLEE: WARNING: undefined reference to function: fstat
KLEE: WARNING: undefined reference to function: ftello64
KLEE: WARNING: undefined reference to function: gelf_getclass
KLEE: WARNING: undefined reference to function: gelf_getehdr
KLEE: WARNING: undefined reference to function: gelf_getnote
KLEE: WARNING: undefined reference to function: gelf_getphdr
KLEE: WARNING: undefined reference to function: gelf_getshdr
KLEE: WARNING: undefined reference to function: gelf_getsym
KLEE: WARNING: undefined reference to function: gzclose
KLEE: WARNING: undefined reference to function: gzgets
KLEE: WARNING: undefined reference to function: gzopen64
KLEE: WARNING: undefined reference to function: ioctl
KLEE: WARNING: undefined reference to function: lseek64
KLEE: WARNING: undefined reference to function: mkdir
KLEE: WARNING: undefined reference to function: mmap64
KLEE: WARNING: undefined reference to function: munmap
KLEE: WARNING: undefined reference to function: nanosleep
KLEE: WARNING: undefined reference to function: open
KLEE: WARNING: undefined reference to function: open64
KLEE: WARNING: undefined reference to function: read
KLEE: WARNING: undefined reference to function: readlink
KLEE: WARNING: undefined reference to function: setrlimit64
KLEE: WARNING: undefined reference to function: sigprocmask
KLEE: WARNING: undefined reference to function: snprintf
KLEE: WARNING: undefined reference to function: sprintf
KLEE: WARNING: undefined reference to function: statfs64
KLEE: WARNING: undefined reference to function: syscall
KLEE: WARNING: undefined reference to function: time
KLEE: WARNING: undefined reference to function: unlink
KLEE: WARNING: undefined reference to function: vfork
KLEE: WARNING: undefined reference to function: vsnprintf
KLEE: WARNING: undefined reference to function: wait4
KLEE: WARNING: undefined reference to function: write
KLEE: WARNING: undefined reference to function: kill (UNSAFE)!
KLEE: WARNING ONCE: calling __user_main with extra arguments.
KLEE: WARNING ONCE: calling external: syscall(321, 0, 140145694019584, 120) at exploit.c:55 12
KLEE: WARNING ONCE: calling external: printf(140234009284608, 12) at exploit.c:255 8
Return from syscall : 12
[+] eBPF enabled, ringbuf created!
[!] staring to create new maps until we get two consecutive maps
[+] created map 1
KLEE: WARNING ONCE: calling external: open(140233472413696, 0) at exploit.c:166 9
KLEE: WARNING ONCE: calling external: read(14, 140117239861248, 8) at exploit.c:174 17
[+] generated random value: cee3ab69fa48f403
[+] created map 2
[+] generated random value: f81577d87094b5fe
[+] two new maps created!
KLEE: WARNING ONCE: Alignment of memory from call "calloc" is not modelled. Using alignment of 8.
KLEE: WARNING ONCE: calling external: getpagesize() at ringbuf.c:196 18
    };

root@syzkaller:~/DRACO-verifier/examples/CVE-2022-23222-POC# make symbex-cve-2022-2322

# compile the program
clang-13 \
        -DKLEE_VERIFICATION\
        -DVERIFY_INTERACTIONS\
        -DKLEE_SYM_PRINTF \
        -I/root/DRACO-verifier/examples/CVE-2022-23222-POC/../headers/ -I /usr/include/unknown-linux-gnu -I/root/DRACO-verifier/examples/../ebpf-se/libbpf-stubbed/src/build/usr/include/  \
        -I  \
        -D__USE_VMLINUX__ \
        -D__TARGET_ARCH_x86 \
        -DBPF_NO_PRESERVE_ACCESS_INDEX \
        -Wall \
        -Wno-unused-value \
        -Wno-unused-variable \
        -Wno-pointer-sign \
        -Wno-compare-distinct-pointer-types \
        -Werror \
        -fno-discard-value-names \
        -fno-builtin \
        -O0 -emit-llvm -c -g exploit.c
llvm-dis-13 -show-annotations exploit.bc
/root/DRACO-verifier/klee/build/bin/klee -kdalloc -kdalloc-heap-start-address=0x00040000000 -kdalloc-heap-size=1 -libc=uclibc --external-calls=all --disable-verify \
        -solver-backend=z3 --exit-on-error -max-memory=750000 -search=dfs -single-object-resolution=true -link-llvm-lib=/root/DRACO-verifier/ebpf-se/libbpf-stubbed/src/obj/libbpf.bc \
        -verification=true exploit.bc
KLEE: NOTE: Using klee-uclibc : /root/DRACO-verifier/klee/build/runtime/lib/klee-uclibc.bca
KLEE: output directory is "/root/DRACO-verifier/examples/CVE-2022-23222-POC/klee-out-4"
KLEE: Using Z3 solver backend
KLEE: Deterministic allocator: Using quarantine queue size 8
KLEE: Deterministic allocator: globals (start-address=0x7f06245a2000 size=10 GiB)
KLEE: Deterministic allocator: constants (start-address=0x7f03a45a2000 size=10 GiB)
KLEE: Deterministic allocator: heap (start-address=0x40000000 size=1 GiB)
KLEE: Deterministic allocator: stack (start-address=0x7ee3a45a2000 size=128 GiB)
KLEE: WARNING ONCE: unsupported intrinsic llvm.vector.reduce.add.v4i32
WARNING: this target does not support the llvm.stacksave intrinsic.
KLEE: WARNING: undefined reference to function: __ctype_b_loc
KLEE: WARNING: undefined reference to function: __isoc99_fscanf
KLEE: WARNING: undefined reference to function: __isoc99_sscanf
KLEE: WARNING: undefined reference to function: __syscall_rt_sigaction
KLEE: WARNING: undefined reference to function: _stdio_init
KLEE: WARNING: undefined reference to function: bcmp
KLEE: WARNING: undefined reference to function: clock_gettime
KLEE: WARNING: undefined reference to function: close
KLEE: WARNING: undefined reference to function: dup3
KLEE: WARNING: undefined reference to function: elf64_getehdr
KLEE: WARNING: undefined reference to function: elf64_getshdr
KLEE: WARNING: undefined reference to function: elf64_newehdr
KLEE: WARNING: undefined reference to function: elf_begin
KLEE: WARNING: undefined reference to function: elf_end
KLEE: WARNING: undefined reference to function: elf_errmsg
KLEE: WARNING: undefined reference to function: elf_getdata
KLEE: WARNING: undefined reference to function: elf_getphdrnum
KLEE: WARNING: undefined reference to function: elf_getscn
KLEE: WARNING: undefined reference to function: elf_getshdrnum
KLEE: WARNING: undefined reference to function: elf_getshdrstrndx
KLEE: WARNING: undefined reference to function: elf_kind
KLEE: WARNING: undefined reference to function: elf_memory
KLEE: WARNING: undefined reference to function: elf_ndxscn
KLEE: WARNING: undefined reference to function: elf_newdata
KLEE: WARNING: undefined reference to function: elf_newscn
KLEE: WARNING: undefined reference to function: elf_nextscn
KLEE: WARNING: undefined reference to function: elf_rawdata
KLEE: WARNING: undefined reference to function: elf_strptr
KLEE: WARNING: undefined reference to function: elf_update
KLEE: WARNING: undefined reference to function: elf_version
KLEE: WARNING: undefined reference to function: epoll_create1
KLEE: WARNING: undefined reference to function: epoll_ctl
KLEE: WARNING: undefined reference to function: epoll_wait
KLEE: WARNING: undefined reference to function: execve
KLEE: WARNING: undefined reference to function: faccessat
KLEE: WARNING: undefined reference to function: fcntl
KLEE: WARNING: undefined reference to function: fcntl64
KLEE: WARNING: undefined reference to function: fmemopen
KLEE: WARNING: undefined reference to function: fopen64
KLEE: WARNING: undefined reference to function: fseeko64
KLEE: WARNING: undefined reference to function: fstat
KLEE: WARNING: undefined reference to function: ftello64
KLEE: WARNING: undefined reference to function: gelf_getclass
KLEE: WARNING: undefined reference to function: gelf_getehdr
KLEE: WARNING: undefined reference to function: gelf_getnote
KLEE: WARNING: undefined reference to function: gelf_getphdr
KLEE: WARNING: undefined reference to function: gelf_getshdr
KLEE: WARNING: undefined reference to function: gelf_getsym
KLEE: WARNING: undefined reference to function: gzclose
KLEE: WARNING: undefined reference to function: gzgets
KLEE: WARNING: undefined reference to function: gzopen64
KLEE: WARNING: undefined reference to function: ioctl
KLEE: WARNING: undefined reference to function: lseek64
KLEE: WARNING: undefined reference to function: mkdir
KLEE: WARNING: undefined reference to function: mmap64
KLEE: WARNING: undefined reference to function: munmap
KLEE: WARNING: undefined reference to function: nanosleep
KLEE: WARNING: undefined reference to function: open
KLEE: WARNING: undefined reference to function: open64
KLEE: WARNING: undefined reference to function: read
KLEE: WARNING: undefined reference to function: readlink
KLEE: WARNING: undefined reference to function: setrlimit64
KLEE: WARNING: undefined reference to function: sigprocmask
KLEE: WARNING: undefined reference to function: snprintf
KLEE: WARNING: undefined reference to function: sprintf
KLEE: WARNING: undefined reference to function: statfs64
KLEE: WARNING: undefined reference to function: syscall
KLEE: WARNING: undefined reference to function: time
KLEE: WARNING: undefined reference to function: unlink
KLEE: WARNING: undefined reference to function: vfork
KLEE: WARNING: undefined reference to function: vsnprintf
KLEE: WARNING: undefined reference to function: wait4
KLEE: WARNING: undefined reference to function: write
KLEE: WARNING: undefined reference to function: kill (UNSAFE)!
KLEE: WARNING ONCE: calling __user_main with extra arguments.
KLEE: WARNING ONCE: calling external: syscall(321, 0, 139569867137024, 120) at exploit.c:55 12
KLEE: WARNING ONCE: calling external: printf(139658182402048, 12) at exploit.c:256 8
Return from syscall : 12
[+] eBPF enabled, ringbuf created!
[!] staring to create new maps until we get two consecutive maps
[+] created map 1
KLEE: WARNING ONCE: calling external: open(139657645531136, 0) at exploit.c:167 9
KLEE: WARNING ONCE: calling external: read(14, 139541412978688, 8) at exploit.c:175 17
[+] generated random value: 679135b89a330001
[+] created map 2
[+] generated random value: 6f6240d9f570d041
[+] two new maps created!
KLEE: WARNING ONCE: Alignment of memory from call "calloc" is not modelled. Using alignment of 8.
KLEE: WARNING ONCE: calling external: getpagesize() at ringbuf.c:196 18
KLEE: WARNING ONCE: calling external: epoll_create1(524288) at ringbuf.c:198 6
KLEE: WARNING ONCE: Alignment of memory from call "realloc" is not modelled. Using alignment of 8.
KLEE: WARNING ONCE: calling external: mmap64(0, 4096, 3, 1, 12, 0) at ringbuf.c:0 0
KLEE: WARNING ONCE: calling external: epoll_ctl(17, 1, 12, 1308622848) at ringbuf.c:153 56
KLEE: WARNING ONCE: calling external: write(1, 139520475013120, 1) at libc/stdio/_WRITE.c:52 11


KLEE: WARNING ONCE: calling external: close(0) at exploit.c:154 11
-----[-] failed to run eBPF program!
[+] value read from slab: 0


-----[-] failed to run eBPF program!
[+] value read from slab: 0
[+] created map 3
[+] generated random value: 9cc97f45028f8804
[+] created map 4
[+] generated random value: cc7554a0f88a5af7
[+] eBPF enabled, maps created!


-----[-] failed to run eBPF program!
[+] value read from slab: 0
^CKLEE: ctrl-c detected, requesting interpreter to halt.
KLEE: halting execution, dumping remaining states
KLEE: ERROR: EXITING ON ERROR:
Execution halting.


make: *** [../Makefile:261: symbex-cve-2022-2322] Error 1

root@syzkaller:~/DRACO-verifier/examples/CVE-2022-23222-POC# 







